<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Element Dimensions</title>
    <script src="/__jquery.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/jquery-ui.min.js"
      integrity="sha512-MSOo1aY+3pXCOCdGAYoBZ6YGI0aragoQsg1mKKBHXCYPIWxamwOE7Drh+N5CPgGI5SA9IEKJiPjdfqWFWmZtRA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/themes/black-tie/jquery-ui.min.css"
      integrity="sha512-bVIVlufxYIog6AKd3iWWUpQ/OSA0Zk4h0g1d2X42010UmLrpF9fPkNyQYMZSb+pt85IwdJIbGEiHWg3d5chHNQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script type="module">
      import * as tinyHtml from './src/v1/basics/html.mjs';
      import { TinyHtml } from './src/v1/libs/TinyHtml.mjs';
      Object.assign(window, tinyHtml);
      window.TinyHtml = TinyHtml;
    </script>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        background: #fafafa;
        color: #333;
      }
      #test-box {
        width: 200px;
        height: 100px;
        padding: 20px;
        border: 5px solid black;
        margin: 10px auto;
        background: lightblue;
        overflow: hidden;
        position: relative;
      }
      #controls,
      #result,
      #jquery-result,
      #comparison {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #fff;
        z-index: 9999;
        padding: 10px;
        border: 1px solid #ccc;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        max-height: 90vh;
        overflow-y: auto;
        max-width: 400px;
      }
      #result {
        top: 20px;
        left: 20px;
      }
      #jquery-result {
        top: 20px;
        right: 20px;
      }
      #comparison {
        top: auto;
        bottom: 20px;
        left: 20px;
      }
      #controls {
        top: auto;
        bottom: 20px;
      }
      pre {
        white-space: pre-wrap;
        background: #f5f5f5;
        padding: 10px;
        border: 1px solid #ccc;
        overflow-x: auto;
      }
      #comparison {
        background: #fff6f6;
        border-color: #f88;
      }
      label {
        display: block;
        margin-bottom: 10px;
      }
      input[type='number'] {
        width: 80px;
        margin-left: 10px;
      }
      button {
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <div id="test-box" contenteditable="true">
      Test box<br />Scroll down<br /><br /><br /><br /><br /><br /><br /><br /><br />Bottom
    </div>

    <pre id="result"></pre>
    <pre id="jquery-result"></pre>
    <pre id="comparison"></pre>

    <div id="controls">
      <h2>Test Controls</h2>
      <label>
        Set Width:
        <input type="number" id="set-width" />
      </label>
      <label>
        Set Height:
        <input type="number" id="set-height" />
      </label>
      <label>
        Scroll Top:
        <input type="number" id="scroll-top" />
      </label>
      <label>
        Scroll Left:
        <input type="number" id="scroll-left" />
      </label>
      <label>
        Set Padding:
        <input type="number" id="set-padding" />
      </label>
      <label>
        Set Margin:
        <input type="number" id="set-margin" />
      </label>
    </div>

    <script type="module">
      const el = document.getElementById('test-box');
      const result = document.getElementById('result');
      const $el = $('#test-box');

      const controls = {
        width: document.getElementById('set-width'),
        height: document.getElementById('set-height'),
        scrollTop: document.getElementById('scroll-top'),
        scrollLeft: document.getElementById('scroll-left'),
        padding: document.getElementById('set-padding'),
        margin: document.getElementById('set-margin'),
      };

      const syncInputs = () => {
        controls.width.value = TinyHtml.width(el);
        controls.height.value = TinyHtml.height(el);
        controls.scrollTop.value = el.scrollTop;
        controls.scrollLeft.value = el.scrollLeft;
        controls.padding.value = parseFloat(getComputedStyle(el).paddingLeft);
        controls.margin.value = parseFloat(getComputedStyle(el).marginTop);
      };

      const attachInputEvents = () => {
        controls.width.addEventListener('input', () => {
          TinyHtml.setWidth(el, parseInt(controls.width.value));
          update();
        });
        controls.height.addEventListener('input', () => {
          TinyHtml.setHeight(el, parseInt(controls.height.value));
          update();
        });
        controls.scrollTop.addEventListener('input', () => {
          TinyHtml.setScrollTop(el, parseInt(controls.scrollTop.value));
          update();
        });
        controls.scrollLeft.addEventListener('input', () => {
          TinyHtml.setScrollLeft(el, parseInt(controls.scrollLeft.value));
          update();
        });
        controls.padding.addEventListener('input', () => {
          el.style.padding = parseInt(controls.padding.value) + 'px';
          update();
        });
        controls.margin.addEventListener('input', () => {
          el.style.margin = parseInt(controls.margin.value) + 'px';
          update();
        });
      };

      $el.draggable().resizable({
        handles: 'all',
        stop: () => update(),
        resize: () => update(),
      });

      const update = () => {
        syncInputs();
        const tinyValues = {
          'TinyHtml.position': JSON.stringify(TinyHtml.position(el)),
          'TinyHtml.offset': JSON.stringify(TinyHtml.offset(el)),
          'TinyHtml.offsetParent': TinyHtml.offsetParent(el).tagName,
          'TinyHtml.cssFloat(paddingLeft)': TinyHtml.cssFloat(el, 'paddingLeft') + 'px',
          'TinyHtml.cssFloats([marginTop, marginBottom])': JSON.stringify(
            TinyHtml.cssFloats(el, ['marginTop', 'marginBottom']),
          ),
          'TinyHtml.height': TinyHtml.height(el) + 'px',
          'TinyHtml.innerHeight': TinyHtml.innerHeight(el) + 'px',
          'TinyHtml.outerHeight': TinyHtml.outerHeight(el) + 'px',
          'TinyHtml.outerHeight (with margin)': TinyHtml.outerHeight(el, true) + 'px',
          'TinyHtml.width': TinyHtml.width(el) + 'px',
          'TinyHtml.innerWidth': TinyHtml.innerWidth(el) + 'px',
          'TinyHtml.outerWidth': TinyHtml.outerWidth(el) + 'px',
          'TinyHtml.outerWidth (with margin)': TinyHtml.outerWidth(el, true) + 'px',
          'TinyHtml.scrollTop': TinyHtml.scrollTop(el) + 'px',
          'TinyHtml.scrollLeft': TinyHtml.scrollLeft(el) + 'px',
        };

        const jQueryValues = {
          '$(el).position()': JSON.stringify($el.position()),
          '$(el).offset()': JSON.stringify($el.offset()),
          '$(el).offsetParent()': $el.offsetParent()[0].tagName,
          "$(el).css('padding-left')": $el.css('padding-left'),
          "parseFloat($(el).css('margin-top')) / margin-bottom": JSON.stringify({
            marginTop: parseFloat($el.css('margin-top')),
            marginBottom: parseFloat($el.css('margin-bottom')),
          }),
          '$(el).height()': $el.height() + 'px',
          '$(el).innerHeight()': $el.innerHeight() + 'px',
          '$(el).outerHeight()': $el.outerHeight() + 'px',
          '$(el).outerHeight(true)': $el.outerHeight(true) + 'px',
          '$(el).width()': $el.width() + 'px',
          '$(el).innerWidth()': $el.innerWidth() + 'px',
          '$(el).outerWidth()': $el.outerWidth() + 'px',
          '$(el).outerWidth(true)': $el.outerWidth(true) + 'px',
          '$(el).scrollTop()': $el.scrollTop() + 'px',
          '$(el).scrollLeft()': $el.scrollLeft() + 'px',
        };

        const resultLines = [];
        const jqueryLines = [];
        const comparisonLines = [];

        const keys = Object.keys(tinyValues);
        const jKeys = Object.keys(jQueryValues);

        for (let i = 0; i < keys.length; i++) {
          const tKey = keys[i];
          const jKey = jKeys[i];
          const tVal = tinyValues[tKey];
          const jVal = jQueryValues[jKey];

          const isEqual = tVal === jVal;
          const status = isEqual ? '✅' : '❌';

          resultLines.push(`${tKey}: ${tVal}`);
          jqueryLines.push(`${jKey}: ${jVal}`);
          comparisonLines.push(`${status} ${tKey.replace('TinyHtml.', '')}`);
        }

        result.textContent = resultLines.join('\n');
        document.getElementById('jquery-result').textContent = jqueryLines.join('\n');
        document.getElementById('comparison').textContent =
          'Comparison Check:\n' + comparisonLines.join('\n');
      };

      document.addEventListener('DOMContentLoaded', () => {
        attachInputEvents();
        update();
      });
      window.addEventListener('scroll', update);
      window.addEventListener('resize', update);
      $(window).on('scroll resize', update);
    </script>
  </body>
</html>
