<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Collision Test</title>
    <script src="/__buffer.js"></script>
    <script type="module">
      import * as tinyHtml from './src/v1/basics/html.mjs';
      import * as tinyCollisions from './src/v1/basics/collision.mjs';
      Object.assign(window, tinyCollisions);
      Object.assign(window, tinyHtml);
    </script>
    <style>
      body {
        margin: 0;
        height: 100vh;
        overflow: hidden;
        background: #f0f0f0;
        font-family: sans-serif;
      }

      #wall {
        position: absolute;
        top: 150px;
        left: 300px;
        width: 200px;
        height: 200px;
        background-color: #0077ff;
      }

      #box {
        position: absolute;
        top: 200px;
        left: 50px;
        width: 100px;
        height: 100px;
        background-color: red;
        cursor: grab;
        transition: box-shadow 0.2s;
      }

      #box.colliding {
        box-shadow: 0 0 10px 4px #ff0000;
      }
    </style>
  </head>
  <body>
    <div id="wall"></div>
    <div id="box"></div>

    <script>
      const box = document.getElementById('box');
      const wall = document.getElementById('wall');
      let offsetX, offsetY;
      let isDragging = false;
      let moveStep = 1; // velocidade em px

      box.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - box.offsetLeft;
        offsetY = e.clientY - box.offsetTop;
        box.style.cursor = 'grabbing';
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        box.style.cursor = 'grab';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        moveBoxTo(e.clientX - offsetX, e.clientY - offsetY);
      });

      document.addEventListener('keydown', (e) => {
        const left = box.offsetLeft;
        const top = box.offsetTop;

        switch (e.key) {
          case 'ArrowLeft':
          case 'a':
            moveBoxTo(left - moveStep, top);
            break;
          case 'ArrowRight':
          case 'd':
            moveBoxTo(left + moveStep, top);
            break;
          case 'ArrowUp':
          case 'w':
            moveBoxTo(left, top - moveStep);
            break;
          case 'ArrowDown':
          case 's':
            moveBoxTo(left, top + moveStep);
            break;
        }
      });

      function moveBoxTo(x, y) {
        box.style.left = `${x}px`;
        box.style.top = `${y}px`;

        const colliding = areHtmlElsCollidingWithLock(box, wall, 'bottom'); // change 'right' if needed
        box.classList.toggle('colliding', colliding);

        const rect1 = box.getBoundingClientRect();
        const rect2 = wall.getBoundingClientRect();

        const details = getElsCollDetails(rect1, rect2);
        console.log('DETAILS', details.depth, details.dirs, details.isNeg);
        // console.log('CENTER', getElsRelativeCenterOffset(rect1, rect2));
        // console.log('DEPTH', getElsCollDirDepth(rect1, rect2));
      }
    </script>
  </body>
</html>
