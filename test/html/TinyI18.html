<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TinyI18 Test Suite</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #f8f9fb;
        margin: 0;
        padding: 0;
        color: #222;
      }
      header {
        background: #4a6cf7;
        color: #fff;
        padding: 1rem 2rem;
      }
      header h1 {
        margin: 0;
        font-size: 1.5rem;
      }
      main {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        padding: 2rem;
      }
      section {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 1rem 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      section h2 {
        margin-top: 0;
        font-size: 1.2rem;
        border-bottom: 1px solid #eee;
        padding-bottom: 0.5rem;
      }
      .result {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: #f0f4ff;
        border-radius: 4px;
        font-family: monospace;
        white-space: pre-wrap;
      }
      button {
        background: #4a6cf7;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 0.4rem 0.8rem;
        margin: 0.2rem;
        cursor: pointer;
        font-size: 0.9rem;
      }
      button:hover {
        background: #3b57d7;
      }
      .lang-buttons {
        margin-top: 0.5rem;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>TinyI18 Professional Test Suite</h1>
    </header>
    <main>
      <!-- Language switching -->
      <section>
        <h2>Language Switching</h2>
        <p>Current language: <span id="current-lang">default</span></p>
        <div class="lang-buttons">
          <button data-lang="en">English</button>
          <button data-lang="pt">Português</button>
          <button data-lang="es">Español</button>
          <button data-lang="">Reset to Default</button>
        </div>
      </section>

      <!-- Simple string test -->
      <section>
        <h2>Simple Keys</h2>
        <p><strong>app.title:</strong></p>
        <div class="result" id="res-title"></div>
        <p><strong>app.items (with {count}=5):</strong></p>
        <div class="result" id="res-items"></div>
      </section>

      <!-- Fallback test -->
      <section>
        <h2>Fallback to Default</h2>
        <p>Try a key missing in the selected locale (e.g. "app.items" in pt).</p>
        <div class="result" id="res-fallback"></div>
      </section>

      <!-- Regex pattern test -->
      <section>
        <h2>Regex Patterns</h2>
        <p>Testing a dynamic key (e.g. "user.123").</p>
        <div class="result" id="res-regex"></div>
      </section>

      <!-- Function entry test -->
      <section>
        <h2>Function Entries</h2>
        <p>Rendering a list via function or $fn helper.</p>
        <div class="result" id="res-fn"></div>
      </section>

      <!-- Interpolation test -->
      <section>
        <h2>Interpolation</h2>
        <p>Key with placeholders {name} and {count}.</p>
        <div class="result" id="res-interpolation"></div>
      </section>

      <!-- Memory & stats -->
      <section>
        <h2>Memory / Stats</h2>
        <p>Inspect loaded locales and counts.</p>
        <button id="btn-stats">Show Stats</button>
        <div class="result" id="res-stats"></div>
      </section>
    </main>

    <script type="module">
      import { TinyI18 } from './src/v1/libs/TinyI18.mjs';
      window.TinyI18 = TinyI18;

      // --- Setup TinyI18 in local mode for demo ---
      const i18 = new TinyI18({
        strict: true,
        mode: 'local',
        defaultLocale: 'en',
      });

      window.i18 = i18;

      i18.registerHelper('richList', ({ items = [] }) => {
        return items.map((x, i) => `#${i + 1}: ${x}`).join(', ');
      });

      i18.loadLocaleLocal('en', {
        app: {
          title: 'Inventory',
          items: '{count} items',
        },
        interpolation: '{name} has {count} items',
        regexTest: {
          match: { $pattern: /^user\.\d+$/, value: 'Matched a user ID key' },
        },
        ui: {
          list: (params) => {
            const items = params?.items ?? [];
            return `List:\n- ${items.join('\n- ')}`;
          },
        },
      });

      i18.loadLocaleLocal('pt', {
        app: {
          title: 'Inventário',
        },
        interpolation: '{name} possui {count} itens',
      });

      i18.loadLocaleLocal('es', {
        app: {
          title: 'Inventario',
          items: '{count} elementos',
        },
        interpolation: '{name} tiene {count} elementos',
      });

      // --- DOM elements ---
      const elLang = document.getElementById('current-lang');
      const resTitle = document.getElementById('res-title');
      const resItems = document.getElementById('res-items');
      const resFallback = document.getElementById('res-fallback');
      const resRegex = document.getElementById('res-regex');
      const resFn = document.getElementById('res-fn');
      const resInterpolation = document.getElementById('res-interpolation');
      const resStats = document.getElementById('res-stats');

      // --- Render function ---
      function renderAll() {
        elLang.textContent = i18.currentLocale || '(default only)';
        resTitle.textContent = i18.t('app.title');
        resItems.textContent = i18.t('app.items', { count: 5 });
        resFallback.textContent = i18.t('app.items', { count: 3 });
        resRegex.textContent = i18.t('user.123');
        resFn.textContent = i18.t('ui.list', { items: ['Apple', 'Banana', 'Cherry'] });
        resInterpolation.textContent = i18.t('interpolation', { name: 'Alice', count: 7 });
      }

      // --- Language buttons ---
      document.querySelectorAll('.lang-buttons button').forEach((btn) => {
        btn.addEventListener('click', async () => {
          const lang = btn.dataset.lang || null;
          await i18.setLocale(lang);
          renderAll();
        });
      });

      // --- Stats button ---
      document.getElementById('btn-stats').addEventListener('click', () => {
        resStats.textContent = JSON.stringify(i18.stats(), null, 2);
      });

      // Initial render
      renderAll();
    </script>
  </body>
</html>
